<!DOCTYPE html>
<html>
  <head>
    <link href="css/reset.css" rel="stylesheet" type="text/css">
    <link href="css/style.css" rel="stylesheet" type="text/css">
	
	<script type="text/javascript" src="js/lib/jquery.js"></script>
	<!-- <script type="text/javascript" src="js/lib/jsqrcode/grid.js"></script>
    <script type="text/javascript" src="js/lib/jsqrcode/version.js"></script>
    <script type="text/javascript" src="js/lib/jsqrcode/detector.js"></script>
    <script type="text/javascript" src="js/lib/jsqrcode/formatinf.js"></script>
    <script type="text/javascript" src="js/lib/jsqrcode/errorlevel.js"></script>
    <script type="text/javascript" src="js/lib/jsqrcode/bitmat.js"></script>
    <script type="text/javascript" src="js/lib/jsqrcode/datablock.js"></script>
    <script type="text/javascript" src="js/lib/jsqrcode/bmparser.js"></script>
    <script type="text/javascript" src="js/lib/jsqrcode/datamask.js"></script>
	<script type="text/javascript" src="js/lib/jsqrcode/rsdecoder.js"></script>
	<script type="text/javascript" src="js/lib/jsqrcode/gf256poly.js"></script>
	<script type="text/javascript" src="js/lib/jsqrcode/gf256.js"></script>
	<script type="text/javascript" src="js/lib/jsqrcode/decoder.js"></script>
	<script type="text/javascript" src="js/lib/jsqrcode/QRCode.js"></script>
	<script type="text/javascript" src="js/lib/jsqrcode/findpat.js"></script>
	<script type="text/javascript" src="js/lib/jsqrcode/alignpat.js"></script>
	<script type="text/javascript" src="js/lib/jsqrcode/databr.js"></script>

	<script type="text/javascript" src="js/qr.js"></script> 
	<script type="text/javascript" src="js/init.js"></script> 
	<script type="text/javascript" src="js/camera.js"></script> -->
  </head>
  <body>

		<div id = "title">
			<h1>Scan QR Code </h1>
		</div>
		
		<div id = "content">
			
			<video  id="vid" autoplay width="320" height="240">Put your fallback message here.</video>
			<canvas id="canvas" width="320" height="240" ></canvas><br>
			
			<button onclick="snapshot()">Take Picture</button>
			<button onclick="scan()">Scan Code</button>
			<a href="home.html" id="platform">Go Back </a>
			
		</div>
		
		<script>
			
			var video = document.querySelector("#vid");
			var canvas = document.querySelector('#canvas');
			var ctx = canvas.getContext('2d');
			var localMediaStream = null;

			var onCameraFail = function (e) {
				console.log('Camera failed.', e);
			};

			var localMediaStream = null;
			
			navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;
			window.URL = window.URL || window.webkitURL;
			navigator.getUserMedia({video:true}, function (stream) {
				video.src = window.URL.createObjectURL(stream);
				localMediaStream = stream;
			}, onCameraFail);
			
			function snapshot() {
				if (localMediaStream) {
					ctx.drawImage(video, 0, 0, 320, 240);
					var snappic = convertCanvasToImage(canvas);
					//var win = window.open();
					//$(win.document.body).html(Canvas2Image.saveAsPNG(canvas, false));
					//exportAndView();
					
				}
			}
			
			function scan() {
				if (snapshot) {
					console.log("hehe");
				}
			}
			
			function convertCanvasToImage(canvas) {
				var str = canvas.toDataURL("image/png");
				var image = document.createElement("img");
				image.src = str;
				var savestr = str.replace("image/png", "image/octet-stream");
				document.location.href = savestr;
				return image;
			}
			
		</script>
		
	</body>
</html>
